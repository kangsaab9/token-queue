<!DOCTYPE html>
<html>
<head>
  <title>Token Queue</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f4f4;
      padding: 20px;
      max-width: 500px;
      margin: auto;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .box {
      background: #fff;
      padding: 20px;
      margin-top: 30px;
      border-radius: 15px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    input {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border: none;
      border-radius: 25px;
      font-weight: bold;
      color: white;
      background-color: #007BFF;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #0056b3;
    }
    .token-display {
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      margin-top: 20px;
    }
    .circle-row {
      display: flex;
      justify-content: space-around;
      margin-top: 20px;
    }
    .circle {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: bold;
      color: white;
    }
    .prev { background-color: #ffc107; }
    .current { background-color: #28a745; }
    .next { background-color: #17a2b8; }
    .admin-controls button {
      width: 48%;
      margin: 5px 1%;
      background-color: #6f42c1;
    }
    .admin-controls button:hover {
      background-color: #563d7c;
    }
    .hidden {
      display: none;
    }
    #todayDate {
      text-align: center;
      font-weight: bold;
      font-size: 16px;
      margin-bottom: 10px;
      color: #555;
    }
  </style>
</head>
<body>
   <h1>üéü Token Queue</h1>

  <div class="box">
    <h2>Request a Token</h2>
    <input type="text" id="username" placeholder="Enter your name">
    <label for="queueDate">Select Date:</label>
    <input type="date" id="queueDate">
    <button onclick="getToken()">Get Token</button>
    <p id="yourToken" class="token-display"></p>
  </div>

  <div class="box">
    <h2>Now Serving (Admin Selection Required)</h2>
    <div class="circle-row">
      <div class="circle prev" id="prevToken">-</div>
      <div class="circle current" id="currentToken">0</div>
      <div class="circle next" id="nextToken">-</div>
    </div>
    <p id="currentServingDetails">Select date in Admin Panel.</p>
  </div>

  <div class="box">
    <h2>Admin Panel</h2>
    <input type="password" id="adminPass" placeholder="Enter admin password">
    <button onclick="showAdmin()">Login</button>
    <div id="adminControls" class="hidden">
      
      <h3>View Tokens for Date:</h3>
      <input type="date" id="adminDateSelect">
      <button onclick="loadTokensForAdmin()">Load Tokens</button>
      
      <div id="queueControls" class="admin-controls hidden">
        <h3>Queue Control for <span id="selectedDateDisplay"></span></h3>
        <button onclick="prevToken()">‚èÆ Previous</button>
        <button onclick="nextToken()">‚è≠ Next</button>
      </div>
      
      <button onclick="deleteTokensByDate()" class="delete-button">üóë Delete Data for Selected Date</button>
    </div>
  </div>

  <script>
    // --- Global State Variables ---
    // Stores tokens: { "YYYY-MM-DD": [{number: 1, name: "Name"}, ...] }
    let allTokens = {}; 
    let currentTokenQueue = []; // The queue for the currently selected date
    let currentTokenIndex = 0;
    let selectedAdminDate = null; // The date currently being managed by admin

    const STORAGE_KEY = 'tokenQueueData';
    const ADMIN_PASS = "admin123";

    // --- Data Persistence Functions ---

    function loadAllTokens() {
        const storedData = localStorage.getItem(STORAGE_KEY);
        if (storedData) {
            allTokens = JSON.parse(storedData);
        } else {
            allTokens = {};
        }
    }

    function saveAllTokens() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(allTokens));
    }

    // --- User Token Functions ---

    function getDefaultDate() {
        return new Date().toISOString().split('T')[0];
    }
    
    // Set default date for user selection
    document.getElementById("queueDate").value = getDefaultDate();
    document.getElementById("adminDateSelect").value = getDefaultDate();


    function getToken() {
      const name = document.getElementById("username").value.trim();
      const date = document.getElementById("queueDate").value;

      if (!name || !date) {
        alert("Please enter your name and select a date.");
        return;
      }
      
      // Initialize the queue for this date if it doesn't exist
      if (!allTokens[date]) {
          allTokens[date] = [];
      }
      
      // Determine the next token number for THIS date
      const nextTokenNumber = allTokens[date].length + 1;
      
      const newToken = { number: nextTokenNumber, name: name };
      
      // Add token and save
      allTokens[date].push(newToken);
      saveAllTokens();

      document.getElementById("yourToken").innerText = ${name}, your token for ${date} is: ${nextTokenNumber};
    }

    // --- Admin Control Functions ---

    function showAdmin() {
      const pass = document.getElementById("adminPass").value;
      if (pass === ADMIN_PASS) {
        document.getElementById("adminControls").classList.remove("hidden");
        // Load tokens for the default date when logging in
        loadTokensForAdmin(); 
      } else {
        alert("Wrong password!");
      }
    }

    function loadTokensForAdmin() {
        selectedAdminDate = document.getElementById("adminDateSelect").value;
        if (!selectedAdminDate) {
            alert("Please select a date to manage.");
            return;
        }

        // Set the current queue to the queue for the selected date
        currentTokenQueue = allTokens[selectedAdminDate] || [];
        currentTokenIndex = 0; // Reset to the start of the queue
        
        document.getElementById("selectedDateDisplay").innerText = selectedAdminDate;
        document.getElementById("queueControls").classList.remove("hidden");

        updateTokenDisplay();
    }

    function nextToken() {
      if (currentTokenIndex < currentTokenQueue.length) {
          currentTokenIndex++;
          updateTokenDisplay();
      }
    }

    function prevToken() {
      if (currentTokenIndex > 0) {
        currentTokenIndex--;
        updateTokenDisplay();
      }
    }
    
    function deleteTokensByDate() {
        const dateToDelete = document.getElementById("adminDateSelect").value;
        if (!dateToDelete) {
            alert("Please select a date to delete.");
            return;
        }

        if (confirm(Are you sure you want to delete ALL token data for the date: ${dateToDelete}? This cannot be undone.)) {
            // Delete the entry from the global allTokens object
            delete allTokens[dateToDelete];
            saveAllTokens();
            
            // Clear the currently displayed queue if it matches the deleted date
            if (selectedAdminDate === dateToDelete) {
                currentTokenQueue = [];
                currentTokenIndex = 0;
            }
            updateTokenDisplay();
            alert(Token data for ${dateToDelete} has been deleted.);
        }
    }


    // --- Display Update Functions ---

    function updateTokenDisplay() {
      // Determine which token to display (index-based)
      const currentTokenData = currentTokenQueue[currentTokenIndex] || { number: 0, name: '-' };
      const previousTokenData = currentTokenQueue[currentTokenIndex - 1] || { number: '-', name: '-' };
      const nextTokenData = currentTokenQueue[currentTokenIndex + 1] || { number: '-', name: '-' };

      // Update the circles
      document.getElementById("currentToken").innerText = currentTokenData.number;
      document.getElementById("prevToken").innerText = previousTokenData.number;
      document.getElementById("nextToken").innerText = nextTokenData.number;

      // Update the details line with the name
      if (currentTokenData.number > 0) {
          document.getElementById("currentServingDetails").innerHTML = **Token ${currentTokenData.number}**: ${currentTokenData.name} on **${selectedAdminDate}**;
      } else if (selectedAdminDate) {
          document.getElementById("currentServingDetails").innerText = Queue for ${selectedAdminDate} is empty or completed.;
      } else {
          document.getElementById("currentServingDetails").innerText = Select date in Admin Panel.;
      }
    }

    // --- Initialization ---

    loadAllTokens();
    updateTokenDisplay(); // Initial display state
  </script>
</body>
</html>
